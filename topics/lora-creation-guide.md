# Создание LoRA: пошаговый практический гайд

LoRA (Low-Rank Adaptation) позволяет создавать персонализированные модели без переобучения основной нейросети. Это практическое руководство по созданию собственной LoRA.

## Что такое LoRA и зачем она нужна?

### Простая аналогия

Представь флешку:
- **Основная модель** = компьютер (большой, мощный)
- **LoRA** = флешка (маленькая, добавляет контекст)

LoRA добавляет дополнительную информацию, не меняя основную модель. Это как добавить файлы на флешку, не переустанавливая операционную систему.

### Преимущества LoRA

✅ **Маленький размер**: 50-100 МБ (вместо гигабайтов)
✅ **Быстрое обучение**: 10-30 минут (вместо дней)
✅ **Гибкость**: можно комбинировать несколько LoRA
✅ **Эффективность**: не нужно мощное оборудование

## Шаг 1: Создание датасета

### Сколько фотографий нужно?

**Рекомендации**:
- **Минимум**: 10-15 фотографий
- **Оптимально**: 20-30 фотографий
- **Максимум**: 50 фотографий (больше может перегрузить модель)

**Важно**: качество важнее количества!

### Критерии отбора фотографий

#### ✅ Хорошие фотографии

**1. Хорошее лицо**:
- Лицо хорошо видно
- Чёткие черты
- Хорошее освещение
- Анфас предпочтительнее

**2. Разнообразие**:
- Разная одежда
- Разные локации
- Разные фоны
- Разные позы

**3. Качество**:
- Хорошее разрешение
- Резкость
- Нет размытия
- Хорошая композиция

**4. Пропорции**:
- Нормальные пропорции (не искажённые)
- Избегайте широкоугольных объективов
- Фотографии в полный рост для обучения пропорциям

#### ❌ Плохие фотографии

**1. Проблемы с лицом**:
- Закрытые глаза
- Тень на лице
- Плохое освещение
- Лицо слишком маленькое

**2. Искажения**:
- Широкоугольные объективы (искажают пропорции)
- Съёмка снизу вверх
- Съёмка сверху вниз (сильное искажение)

**3. Дубликаты**:
- Похожие фотографии
- Одинаковая одежда и фон
- Одинаковые позы
- Профессиональные фото в студии (могут восприниматься как одинаковые)

**4. Сложные элементы**:
- Сложный пейзаж на фоне
- Много людей в кадре
- Человек слишком мал в кадре
- Странные позы

**5. Специфические проблемы**:
- Фотографии в зеркале (если их слишком много)
- Человек держит волосы
- Человек пьёт или держит предметы (не переусердствуйте)

### Примеры хороших и плохих фотографий

**✅ Хорошо**:
- Портрет анфас с хорошим освещением
- Фотография в полный рост на нейтральном фоне
- Разные локации (дом, улица, природа)
- Разная одежда (формальная, повседневная)
- Разные эмоции (улыбка, серьёзное выражение)

**❌ Плохо**:
- 10 фотографий в зеркале
- 5 профессиональных фото в студии с одинаковым фоном
- Фотографии с широкоугольным объективом
- Фотографии снизу вверх
- Фотографии, где человек слишком мал

## Шаг 2: Подготовка фотографий

### Обрезка и кадрирование

**Цель**: сделать человека главным объектом в кадре

**Как делать**:
1. Обрежьте лишний фон
2. Удалите "воздух" вокруг человека
3. Сфокусируйтесь на лице (для портретов)
4. Оставьте немного пространства (для фотографий в полный рост)

**Пример**:
```
До: [большой фон] [человек маленький] [большой фон]
После: [немного фона] [человек крупно] [немного фона]
```

### Разнообразие макияжа

**Важно**:
- Разные макияжи помогают модели лучше понять лицо
- Не бойтесь использовать фотографии с макияжем
- Модель не будет рисовать макияж постоянно, если есть разнообразие

**Рекомендация**: используйте фотографии с разными макияжами, но не переусердствуйте.

## Шаг 3: Настройка обучения

### Выбор платформы

**SYNTX** (Telegram-бот):
- Простой интерфейс
- Не требует технических знаний
- Удобно для начинающих

**Другие варианты**:
- AUTOMATIC1111 (локально)
- Kohya (более продвинутый)
- Онлайн-сервисы

### Процесс обучения в SYNTX

**Шаг 1: Начало**:
1. Откройте Telegram-бот SYNTX
2. Выберите раздел "Тренировка"
3. Выберите новую версию обучения

**Шаг 2: Загрузка фотографий**:
1. Загрузите подготовленные фотографии (20-30 штук)
2. Проверьте, что все фотографии загружены правильно
3. Убедитесь, что нет дубликатов

**Шаг 3: Настройка шагов**:
- Система автоматически определяет количество шагов
- Можно настроить вручную:
  - **Больше шагов** (1000-2000): для разнообразных фотографий
  - **Меньше шагов** (500-1000): для минимизации влияния похожих фотографий

**Рекомендация**: начните с автоматических настроек, затем экспериментируйте.

### Важные моменты при обучении

**1. Избегайте дубликатов**:
- Нейросеть может воспринимать похожие фотографии как одинаковые
- Это приводит к переобучению на конкретные элементы
- Результат: модель будет генерировать только похожие изображения

**2. Разнообразие**:
- Только один повторяющийся элемент (лицо человека)
- Всё остальное должно быть разнообразным:
  - Одежда
  - Фон
  - Позы
  - Эмоции

**3. Влияние улыбки**:
- Большое количество улыбающихся фотографий может привести к тому, что модель будет всегда генерировать улыбку
- Используйте разнообразие эмоций

## Шаг 4: Тестирование модели

### Базовое тестирование

**Параметры для тестирования**:
- Количество одновременной генерации: 3-5
- Соотношение сторон: 1:1 или 16:9
- Креативность: средняя

**Проверка разнообразия**:
1. Используйте один и тот же промпт
2. Генерируйте несколько раз
3. Проверьте, что результаты разнообразные

**Хороший результат**: разные позы, одежда, фон, но одно и то же лицо

**Плохой результат**: все изображения очень похожи (переобучение)

### Тестирование на сложных промптах

**Где найти промпты**:
- Сайт Civitai
- Сообщество Stable Diffusion
- Примеры из галереи

**Что проверять**:
1. Сохранение черт лица
2. Соответствие промпту
3. Качество генерации
4. Разнообразие результатов

**Пример**:
```
Промпт: "женщина в клетчатой рубашке в офисе"
Результат: разные офисы, разные позы, но одно лицо
```

## Шаг 5: Работа с готовыми LoRA

### Поиск LoRA

**Где искать**:
- **Civitai**: крупнейшая библиотека LoRA
- **Hugging Face**: модели и LoRA
- **Сообщества**: Reddit, Discord

**Что искать**:
- Стили художников
- Конкретные персонажи
- Специфические стили
- Одежда и аксессуары

### Добавление LoRA в модель

**В SYNTX**:
1. Найдите LoRA на сайте (например, Civitai)
2. Скопируйте ссылку на LoRA
3. Добавьте в настройки модели в Telegram-боте
4. Настройте силу LoRA (обычно 0.7-1.0)

**Сила LoRA**:
- **0.5-0.7**: слабое влияние (для сохранения черт лица)
- **0.7-1.0**: нормальное влияние
- **1.0+**: сильное влияние (может перекрыть другие LoRA)

### Комбинирование LoRA

**Возможности**:
- Можно использовать несколько LoRA одновременно
- Комбинировать стиль художника + персонаж
- Создавать уникальные результаты

**Пример**:
```
LoRA персонажа (Кристина) + LoRA стиля (Сэм Янг) =
Кристина в стиле Сэма Янга
```

**Важно**: при комбинировании настраивайте силу каждой LoRA, чтобы они не конфликтовали.

## Частые проблемы и решения

### Проблема 1: Модель генерирует одинаковые изображения

**Причина**: переобучение, слишком много похожих фотографий

**Решение**:
- Уменьшите количество шагов
- Добавьте больше разнообразия в датасет
- Уберите дубликаты

### Проблема 2: Лицо не сохраняется

**Причина**: недостаточно хороших фотографий лица

**Решение**:
- Добавьте больше портретов анфас
- Улучшите качество фотографий
- Увеличьте количество шагов

### Проблема 3: Модель всегда улыбается

**Причина**: слишком много улыбающихся фотографий

**Решение**:
- Добавьте фотографии с разными эмоциями
- Уменьшите количество улыбающихся фото

### Проблема 4: Искажённые пропорции

**Причина**: фотографии с широкоугольными объективами

**Решение**:
- Уберите такие фотографии из датасета
- Используйте фотографии с нормальными пропорциями

## Практические советы

### Для начинающих

1. **Начните с малого**: 15-20 хороших фотографий
2. **Используйте простые промпты**: сначала проверьте базовую работу
3. **Экспериментируйте**: пробуйте разные настройки
4. **Изучайте примеры**: смотрите, как другие создают LoRA

### Для продвинутых

1. **Тонкая настройка**: экспериментируйте с шагами и параметрами
2. **Комбинирование**: используйте несколько LoRA
3. **Создание стилей**: обучайте LoRA на художественных стилях
4. **Оптимизация**: уменьшайте размер LoRA без потери качества

## Примеры использования

### Пример 1: Персонализированный персонаж

**Задача**: создать LoRA себя для использования в разных сценах

**Процесс**:
1. Соберите 20-25 своих фотографий
2. Отберите лучшие (хорошее лицо, разнообразие)
3. Обрежьте и подготовьте
4. Обучите LoRA
5. Используйте в промптах: "человек [ваш токен] как астронавт"

### Пример 2: Стиль художника

**Задача**: создать LoRA в стиле конкретного художника

**Процесс**:
1. Соберите 30-40 изображений в нужном стиле
2. Убедитесь в разнообразии (разные сюжеты, композиции)
3. Обучите LoRA
4. Используйте: "изображение в стиле [токен]"

### Пример 3: Комбинирование

**Задача**: персонаж в стиле художника

**Процесс**:
1. Используйте LoRA персонажа
2. Добавьте LoRA стиля
3. Настройте силу каждой LoRA
4. Генерируйте уникальные результаты

## Уровень
2-3

## Примеры из жизни
- Создание персонализированных персонажей для проектов
- Обучение стиля конкретного художника
- Создание консистентных персонажей для историй
- Комбинирование разных LoRA для уникальных результатов

## Полезные ссылки для этого уровня
- [Civitai](https://civitai.com) — библиотека LoRA и моделей
- [SYNTX Telegram-бот](ссылка)
- [Kohya SS](https://github.com/bmaltais/kohya_ss) — продвинутый инструмент для обучения

## Заметки
